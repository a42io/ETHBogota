import{a as c,an as V,j as t,f as x,c as U,a$ as X,aJ as Z,r as n,u as _,b0 as ee,b1 as te,aO as se,aK as ne,d as g,b2 as oe,P as ae,C as re,aQ as ie,aR as ce,at as P,S as $,B as b,L as z,I as F,T as le,M as de,b3 as ue}from"./index.0583ad3b.js";import{u as pe}from"./useIsMountedRef.78a048d2.js";import{j as ge,M as he,F as fe,I as me,S as xe}from"./EventNewEventForm.a3b19548.js";import{S as h}from"./Skeleton.80651c49.js";import"./icon_plan_premium.4828f84f.js";import"./illustration_404.6d1d2ea2.js";import"./transition.1cb4ca21.js";import"./warn-once.65f3cd77.js";function ye(){return c(V,{children:[t(h,{width:"100%",height:560,variant:"rectangular",sx:{borderRadius:2}}),c(x,{sx:{mt:3,display:"flex",alignItems:"center"},children:[t(h,{variant:"circular",width:64,height:64}),c(x,{sx:{flexGrow:1,ml:2},children:[t(h,{variant:"text",height:20}),t(h,{variant:"text",height:20}),t(h,{variant:"text",height:20})]})]})]})}function Ne(){const{themeStretch:M}=U(),u=pe(),{eventId:o}=X(),y=Z(),[a,B]=n.exports.useState(null),{address:l}=_(),{isAuthenticated:i}=ee(),{signMessageAsync:w}=te(),{enqueueSnackbar:k}=se(),{data:S}=ne(),[O,I]=n.exports.useState(null),[W,C]=n.exports.useState(!0),[f,L]=n.exports.useState(""),[j,T]=n.exports.useState(!1),[v,J]=n.exports.useState([]),[p,R]=n.exports.useState([]),[m,Y]=n.exports.useState(""),E=n.exports.useCallback(async()=>{try{const e=await g.get(`/events/${o}`);u.current&&B(e.data)}catch(e){console.error(e),y("/404")}},[o,u,y]),N=n.exports.useCallback(async()=>{if(!!i)try{const e=await g.get(`/proofs?eventId=${o}&limit=1`);u.current&&e.data.proofs.length!==0&&(console.log(e.data.proofs),L(e.data.proofs[0].id))}catch(e){console.error(e),I(e.message)}},[i,o,u]),A=n.exports.useCallback(async()=>{if(!!i)try{const e=await g.get(`/events/${o}/allowedNFTs`);u.current&&(J(e.data.list),R(e.data.list.map((s,r)=>s.tokenType==="ENS"?{id:r+1,eventId:o,tokenType:"ENS",ens:s.ens,accountENS:s.accountENS}:{id:r+1,eventId:o,tokenType:s.tokenType,chainId:s.chainId,contractAddress:s.contractAddress,tokenId:s.tokenId})))}catch(e){I(e.message),console.log(e)}},[o,i,u]),G=n.exports.useCallback(async()=>{if(!m||!o)return;T(!0);const e=p.find(s=>s.id===Number(m));if(!!e){console.log("here"),console.log(l);try{const s=await g.get("/nonce",{params:{a:l}}),{nonce:r}=s.data;let d;e.tokenType==="ENS"?d={app:"zmorpheus.xyz",operation:"proof generation",eventId:o,nonce:r,ens:e.ens}:d={app:"zmorpheus.xyz",operation:"proof generation",eventId:o,nonce:r,nft:{chainId:e.chainId,tokenType:e.tokenType,contractAddress:e.contractAddress,tokenId:e.tokenId}};const D=await w({message:JSON.stringify(d,null,2)}),q=localStorage.getItem("identityCommitment"),K=new oe(q).generateCommitment();console.log("here1");const{data:Q}=await g.post("/proofs",{message:d,signature:D,identityCommitment:K.toString()});k("Joined!",{variant:"success"}),y(`/proofs/${Q.id}`)}catch(s){console.log(s),k("Process Failed",{variant:"error"}),I(s.message)}finally{T(!1)}}},[k,l,o,p,m,w]),H=n.exports.useCallback(e=>{!p.find(r=>r.id===Number(e.target.value))||Y(e.target.value)},[p]);return n.exports.useEffect(()=>{E(),A(),N()},[E,A,N]),n.exports.useEffect(()=>{a&&(l||S)&&i?(a.host.address===l||a.host.ens!==""&&a.host.ens===S||a.managers&&a.managers.some(e=>e.address===l))&&C(!1):C(!0)},[a,l,S,i]),t(ae,{title:"Event Detail",children:c(re,{maxWidth:M?!1:"lg",children:[t(ie,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:j,children:t(ce,{color:"inherit"})}),a&&c(P,{children:[t(ge,{event:a}),c(x,{sx:{p:{xs:3,md:2}},children:[c($,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,mb:2},children:[!W&&t(b,{size:"large",fullWidth:!0,variant:"outlined",color:"info",component:z,to:`/my/${o}/verify`,endIcon:t(F,{icon:"eva:people-fill"}),children:"Verify"}),f&&i&&t(b,{fullWidth:!0,size:"large",variant:"outlined",endIcon:t(F,{icon:"eva:checkmark-circle-2-fill"}),component:z,to:`/proofs/${f}`,children:"Your Proof"})]}),t(he,{children:a.body})]})]}),a&&!f&&t(P,{sx:{mt:3},children:c(x,{sx:{p:{xs:3,md:2}},children:[t(le,{variant:"h3",children:"Check your eligibility \u{1F680}"}),i&&v.length!==0&&c(fe,{fullWidth:!0,sx:{my:1},children:[t(me,{htmlFor:"grouped-select",children:"Your Available Tokens"}),t(xe,{value:m||"",label:"Tokens",onChange:H,children:p.map((e,s)=>{let r;if(e.tokenType==="ENS")r=`${e.accountENS}`;else{const d=`${e.contractAddress.slice(0,15)}..`;e.tokenId?r=`${d}/${e.tokenId}`:r=`${d}`}return t(de,{value:e.id,children:r},s)})})]}),c($,{direction:"row",spacing:1.5,alignItems:"flex-end",sx:{flexGrow:1,my:2},children:[i&&t(b,{fullWidth:!0,variant:"contained",size:"large",disabled:!(!f&&i&&v.length!==0),onClick:G,children:v.length!==0?"Join With Your Token":"You are not allowed"}),!i&&t(ue,{signingMessage:{app:"zmorpheus.xyz",operation:"login"},withCircularProgress:!0})]})]})}),!a&&!O&&t(ye,{})]})})}export{Ne as default};
